import{t as h,h as N,a as p}from"../chunks/BgiXASfF.js";import"../chunks/BIROYZXv.js";import{p as O,a as k,$ as C,s as f,c as l,b as i,m as D,n as F,g as v,r as d,t as H}from"../chunks/CpQaROA0.js";import{s as J}from"../chunks/D1bc0aDY.js";import{i as E}from"../chunks/D1Iy4rpg.js";import{i as R}from"../chunks/CZQ4deT6.js";import{o as z}from"../chunks/BXqaL1Zo.js";var L=h('<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">',1),T=h("<p>Cargando datos...</p>"),q=h('<p style="color: red"> </p>'),B=h('<div class="wrapper"><div class="container"><h2 style="text-align: center;">Integraciones <br><i>Jaime Duffy Panés</i></h2> <hr style="width: 100%; animation: loadHrGraph 1s"> <div class="article"><h3>Distribución de ayudas DANA por municipios</h3></div> <div class="graph-container"><figure class="highcharts-figure svelte-t3krpg"><div id="container"></div> <!> <!></figure></div></div></div>');function Z(S,$){O($,!1);const y="https://sos2425-18.onrender.com/api/v2/dana-grants-subsidies-stats";let r=[],u=D(!0),s=D("");function c(t){return new Promise((a,n)=>{if(document.querySelector(`script[src="${t}"]`))return a();const e=document.createElement("script");e.src=t,e.onload=a,e.onerror=n,document.head.appendChild(e)})}async function j(){i(u,!0),i(s,"");try{console.log(`Solicitando datos a: ${y}`);const t=await fetch(y,{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Error en la respuesta: ${t.status}`);r=await t.json(),console.log(`Datos recibidos: ${r.length} registros`),console.log("Muestra de datos:",r.slice(0,2)),P()}catch(t){console.error(`ERROR al obtener datos: ${t}`),i(s,`Error al cargar datos: ${t.message}`)}finally{i(u,!1)}}function P(){if(!r||r.length===0){console.log("No hay datos para mostrar"),i(s,"No hay datos disponibles");return}console.log("Estructura de los primeros datos:",JSON.stringify(r[0],null,2));const t={};r.forEach(o=>{const e=o.mun_name,g=o.amt_granted;t[e]||(t[e]=0),t[e]+=g}),console.log("Datos agrupados por municipio:",t);const a=Object.entries(t).map(([o,e])=>({name:o,y:e})).sort((o,e)=>e.y-o.y);if(console.log("Datos preparados para el gráfico:",a),a.length===0){i(s,"No se pudieron encontrar datos válidos de municipios y cantidades");return}let n=a.slice(0,10);if(a.length>10){const e=a.slice(10).reduce((g,M)=>g+M.y,0);n.push({name:"Otros municipios",y:e})}Highcharts.chart("container",{chart:{type:"pie",backgroundColor:"rgba(255, 255, 255, 0.8)"},title:{text:"Distribución de ayudas por municipios",align:"center",style:{fontWeight:"bold",fontSize:"18px"}},subtitle:{text:"Fuente: G18-dana-grants-subsidies-stats",align:"center"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f}%",style:{fontSize:"12px"}},showInLegend:!0}},tooltip:{pointFormat:"{series.name}: <b>{point.y:.0f}€</b> ({point.percentage:.1f}%)"},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle"},accessibility:{point:{valueSuffix:"€"}},series:[{name:"Importe total",colorByPoint:!0,data:n}],credits:{enabled:!0,text:"G18-dana-grants-subsidies-stats"}})}z(async()=>{try{await c("https://code.highcharts.com/highcharts.js"),await c("https://code.highcharts.com/modules/heatmap.js"),await c("https://code.highcharts.com/modules/exporting.js"),await c("https://code.highcharts.com/modules/export-data.js"),await c("https://code.highcharts.com/modules/accessibility.js"),await j()}catch(t){i(s,`Error cargando scripts de Highcharts: ${t}`),console.error(t)}}),R();var m=B();N(t=>{var a=L();C.title="Integrations - Jaime Duffy Panés",F(2),p(t,a)});var b=l(m),w=f(l(b),6),x=l(w),_=f(l(x),2);{var A=t=>{var a=T();p(t,a)};E(_,t=>{v(u)&&t(A)})}var G=f(_,2);{var I=t=>{var a=q(),n=l(a,!0);d(a),H(()=>J(n,v(s))),p(t,a)};E(G,t=>{v(s)&&t(I)})}d(x),d(w),d(b),d(m),p(S,m),k()}export{Z as component};
