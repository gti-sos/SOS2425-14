import{t as x,h as ie,a as b}from"../chunks/CcBKTLYU.js";import"../chunks/BQvSbhnN.js";import{p as ne,t as se,a as ce,$ as le,s as r,c,n as D,g as l,m as T,r as f,b as z}from"../chunks/B9KnJm2w.js";import{i as W}from"../chunks/DRx51zI4.js";import{s as v}from"../chunks/D_AC4_dt.js";import{t as w,f as C}from"../chunks/PRg3Qw8M.js";import{i as fe}from"../chunks/B7KipWS9.js";import{o as de}from"../chunks/BKuOihLL.js";var me=x('<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">',1),pe=x('<p style="color: #fff; text-align: center; font-weight: bold;">Cargando datos...</p>'),ge=x('<p style="color: #fff; text-align: center; font-weight: bold;">Cargando datos...</p>'),he=x(`<div class="wrapper"><div class="container"><h2 style="text-align: center;">Integraciones <br><i>Pablo</i></h2> <hr style="width: 55em; animation: loadHrGraph 1s; transition: all 0.3s ease;"> <div><div class="article" style="margin-top: 0;"><h3 style="font-size: 1.5em; text-transform: none;">Relación entre Precipitación y Cibercriminalidad (2021)</h3> <p>Este gráfico de columnas relaciona la precipitación anual con la tasa de delitos de cibercrimen en
                    provincias seleccionadas de Andalucía.</p> <a style="color: #fff;" target="_blank"><i>G15 - precipitation-stats</i></a> <a style="color: #fff; margin-left:1em;" target="_blank"><i>G14-cybercrime-data</i></a> <figure class="chartjs-figure svelte-wpvc02"><!> <div id="g15CrimeChart"></div></figure></div> <div class="article" style="margin-top: 3em;"><h3 style="font-size: 1.5em; text-transform: none;">Relación entre Infracciones y Cibercriminalidad por Comunidad (2023)</h3> <p>Este gráfico de barras muestra la relación entre las infracciones (ITV) y los delitos de cibercriminalidad por comunidades en el año 2023.</p> <a style="color: #fff;" target="_blank"><i>G20 - fines-data</i></a> <a style="color: #fff; margin-left:1em;" target="_blank"><i>G14-cybercrime-data</i></a> <figure class="chartjs-figure svelte-wpvc02"><!> <div id="combinedChart"></div></figure></div> <div class="article" style="margin-top: 2em;"><h3 style="font-size: 1.5em; text-transform: none;">Noticias</h3> <p>Este gráfico de burbujas permite comparar en tiempo real las noticias.</p> <a style="color: #fff;" href="https://openweathermap.org/current" target="_blank"><i>API externa - NewsApi</i></a> <figure class="chartjs-figure svelte-wpvc02"><canvas id="externalChart"></canvas></figure></div></div></div></div>`);function Ee(H,V){ne(V,!1);const S="https://sos2425-15.onrender.com/api/v1/precipitation-stats/",_="https://sos2425-20.onrender.com/api/v1/fines/";let m=T("/api/v1/cybercrime-data"),u=T(!0);async function Y(){z(u,!0);try{console.log(`Solicitando datos a: ${S}`);const e=await fetch("/api/g15precipitation");if(!e.ok)throw new Error("Error al obtener datos de G15");const t=await e.json();console.log(`Solicitando datos a: ${l(m)}`);const o=await fetch(l(m));if(!o.ok)throw new Error("Error al obtener datos de cybercrime-data");const d=await o.json(),a=2020,g=["almería","granada","jaén"].map(i=>{const n=t.find(h=>h.province.toLowerCase()===i&&h.year===a),p=i==="almería"||i==="granada"||i==="jaén"?"Andalucia":null,s=d.find(h=>h.autonomous_community.toLowerCase()===(p==null?void 0:p.toLowerCase())&&h.year===a),oe=s?s.cybersecurity/1e4:0;return{province:i,x:(n==null?void 0:n.annual_precipitation)??0,y:(n==null?void 0:n.deviation)??0,r:oe}});console.log(`Datos combinados: ${g.length} registros`),q(g)}catch(e){console.error("Error combinando datos G15 + Criminalidad:",e)}finally{z(u,!1)}}function q(e){Highcharts.chart("g15CrimeChart",{chart:{type:"column",backgroundColor:"#052a42"},title:{text:"Relación entre Precipitación y Cibercriminalidad (2020)",style:{color:"#fff",fontWeight:"bold"}},xAxis:{categories:e.map(t=>t.province),title:{text:"Provincias",style:{color:"#fff"}},labels:{style:{color:"#fff"}}},yAxis:{min:0,title:{text:"Precipitación Anual (mm)",style:{color:"#fff"}},labels:{style:{color:"#fff"}}},tooltip:{pointFormat:"Precipitación: {point.y} mm, Tasa de Cibercriminalidad: {point.r}",style:{color:"#fff"}},series:[{name:"Provincias",data:e.map(t=>({name:t.province,y:t.x,r:t.r})),color:"#36a2eb",dataLabels:{enabled:!0,format:"{point.y} mm",style:{color:"#fff",fontWeight:"bold"}}}],legend:{itemStyle:{color:"#fff"}}})}async function O(){try{console.log(`Solicitando datos a: ${_}`);const e=await fetch(_);if(!e.ok)throw new Error("Error al obtener datos de API_G20");const t=await e.json();console.log(`Solicitando datos a: ${l(m)}`);const o=await fetch(l(m));if(!o.ok)throw new Error("Error al obtener datos de API_CYBERCRIME");const d=await o.json(),a=2023,g=["Madrid"].map(i=>{const n=t.find(s=>s.city.toLowerCase().includes(i.toLowerCase())&&s.year===a),p=d.find(s=>s.autonomous_community.toLowerCase().includes(i.toLowerCase())&&s.year===a);return{comunidad:i,fines:n?n.itv:0,cybercrime:p?p.criminal_ofense:0}});console.log(`Datos combinados: ${g.length} registros`),U(g)}catch(e){console.error("Error al combinar datos de fines y cybercrime:",e)}finally{}}function U(e){Highcharts.chart("combinedChart",{chart:{type:"bar",backgroundColor:"#052a42"},title:{text:"Infracciones ITV vs Cibercrimen en Madrid (2023)",style:{color:"#fff",fontWeight:"bold"}},xAxis:{categories:["Madrid"],title:{text:null},labels:{style:{color:"#fff"}}},yAxis:{min:0,title:{text:"Cantidad",style:{color:"#fff"}},labels:{style:{color:"#fff"}}},legend:{reversed:!0,itemStyle:{color:"#fff"}},plotOptions:{series:{stacking:"normal",dataLabels:{enabled:!0,style:{color:"#fff",fontWeight:"bold"}}}},tooltip:{shared:!0,style:{color:"#fff"}},series:[{name:"Cibercrimen",data:e.map(t=>t.cybercrime),color:"#ff6384"},{name:"Infracciones ITV",data:e.map(t=>t.fines),color:"#36a2eb"}]})}let y=[];async function X(){y=[];try{console.log("Solicitando datos a: /api/newsapi");const e=await fetch("/api/newsapi");if(!e.ok)throw new Error("Error al obtener datos del servidor proxy");const t=await e.json();for(const o of t)for(const d of o.articles)y.push({label:d.title,data:[{x:Math.random()*100,y:Math.random()*100,r:10}],backgroundColor:J(d.source.name)});console.log(`Datos recibidos: ${y.length} registros`),K()}catch(e){console.error("Error al obtener datos de las noticias:",e)}}function J(e){return{"BBC News":"#FF6384",CNN:"#36A2EB",Reuters:"#FFCE56",TechCrunch:"#4BC0C0",ESPN:"#9966FF"}[e]||"#aaa"}let E;function K(){var t;const e=(t=document.getElementById("externalChart"))==null?void 0:t.getContext("2d");e&&(E&&E.destroy(),E=new Chart(e,{type:"bubble",data:{datasets:y},options:{responsive:!0,plugins:{legend:{labels:{color:"#fff"}},title:{display:!0,text:"Noticias populares por fuente",color:"#fff",font:{size:18,weight:"bold"}}},scales:{x:{title:{display:!0,text:"Posición aleatoria (X)",color:"#fff"},ticks:{color:"#fff"}},y:{title:{display:!0,text:"Posición aleatoria (Y)",color:"#fff"},ticks:{color:"#fff"}}}}}))}function R(e){return new Promise((t,o)=>{if(document.querySelector(`script[src="${e}"]`))return t();const a=document.createElement("script");a.src=e,a.onload=t,a.onerror=o,document.head.appendChild(a)})}de(async()=>{try{await R("https://code.highcharts.com/highcharts.js"),await R("https://cdn.jsdelivr.net/npm/chart.js"),await Y(),await O(),await X()}catch(e){console.error(e)}}),fe();var I=he();ie(e=>{var t=me();le.title="Integrations - Pablo Dominguez",D(2),b(e,t)});var F=c(I),P=r(c(F),4),k=c(P),$=r(c(k),4);v($,"href",S);var L=r($,2),A=r(L,2),Q=c(A);{var Z=e=>{var t=pe();b(e,t)};W(Q,e=>{l(u)&&e(Z)})}D(2),f(A),f(k);var G=r(k,2),N=r(c(G),4);v(N,"href",_);var M=r(N,2),j=r(M,2),ee=c(j);{var te=e=>{var t=ge();b(e,t)};W(ee,e=>{l(u)&&e(te)})}D(2),f(j),f(G);var B=r(G,2),ae=r(c(B),6);f(B),f(P),f(F),f(I),se(()=>{v(L,"href",l(m)),v(M,"href",l(m))}),w(3,A,()=>C),w(3,j,()=>C),w(3,ae,()=>C),w(3,P,()=>C,()=>({duration:400})),b(H,I),ce()}export{Ee as component};
