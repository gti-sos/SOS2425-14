import{t as O,h as ve,a as j}from"../chunks/tvbMF9Pj.js";import"../chunks/V6KxLFIZ.js";import{t as be,v as ye,$ as he,c as p,b as e,m as R,s as o,r as m,h as i,w as ee,x as c,y as ge}from"../chunks/gUvyREcO.js";import{e as E,s as I}from"../chunks/wr67jiHF.js";import{i as F}from"../chunks/DoNM67fw.js";import{e as Ee,i as De}from"../chunks/Dg7488E7.js";import{r as l}from"../chunks/5kF7woBx.js";import{t as we,f as $e}from"../chunks/DQyGuE4Y.js";import{b as u,p as te}from"../chunks/CQDDud96.js";import{i as Te}from"../chunks/DdSIFJQO.js";import{o as xe}from"../chunks/WRe_eenc.js";import{g as Ce}from"../chunks/DDgU0adY.js";var ke=O('<p class="info-message"> </p>'),Ae=O('<form class="create-form"><input placeholder="Comunidad Autónoma" required> <input type="number" placeholder="Año" required> <input placeholder="Delitos Informáticos" required> <input placeholder="Delitos contra la Ciberseguridad" required> <input placeholder="Detenidos / Investigados" required> <button type="submit" class="submit">Crear</button> <button type="button" class="cancel">Cancelar</button></form>'),Re=O('<form class="create-form"><input type="number" placeholder="Desde año"> <input type="number" placeholder="Hasta año"> <input type="number" placeholder="Año exacto"> <input type="text" placeholder="Comunidad autónoma"> <input type="text" placeholder="Delitos informáticos exacto"> <input type="number" placeholder="Delitos inf. desde"> <input type="number" placeholder="Delitos inf. hasta"> <input type="text" placeholder="Ciberseguridad exacto"> <input type="number" placeholder="Ciberseguridad desde"> <input type="number" placeholder="Ciberseguridad hasta"> <input type="text" placeholder="Detenidos exacto"> <input type="number" placeholder="Detenidos desde"> <input type="number" placeholder="Detenidos hasta"> <input type="number" placeholder="Limitar a..."> <input type="number" placeholder="Comenzar desde..."> <button class="btn" type="submit">Buscar</button></form>'),Ie=O('<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td class="actions"><button class="btn-circle" title="Editar Registro"><i class="fas fa-pen"></i></button> <button class="btn-circle" title="Eliminar Registro"><i class="fas fa-times"></i></button></td></tr>'),qe=O('<div class="wrapper dash"><div class="container dash"><!> <div class="header"><h3>Datos de ciberdelincuencia</h3> <div class="actions"><button class="btn"><i class="fas fa-search"></i> Búsqueda</button> <button class="btn"><i class="fas fa-plus"></i> Nuevo registro</button> <button class="btn"><i class="fas fa-sync-alt"></i> Recargar los datos iniciales</button> <button class="btn"><i class="fas fa-trash-alt"></i> Eliminar todos los datos</button></div></div> <!> <!> <div class="seeker"></div> <div class="table-container"><table><thead><tr><th>Comunidad Autónoma</th><th>Año</th><th>Delitos Informáticos</th><th>Delitos Ciberseguridad</th><th>Detenidos / Investigados</th><th>Acciones</th></tr></thead></table> <div class="scroll-body"><table><tbody></tbody></table></div></div></div></div>');function Je(re,ae){be(ae,!1);let $="/api/v1/cybercrime-data",T=R([]),n=R(""),x=R(!1),q=R(!1),f=R({autonomous_community:"",year:"",criminal_ofense:"",cybersecurity:"",arrested_investigated:""}),t=R({from:"",to:"",year:"",autonomous_community:"",criminal_ofense:"",criminal_ofense_from:"",criminal_ofense_to:"",cybersecurity:"",cybersecurity_from:"",cybersecurity_to:"",arrested_investigated:"",arrested_investigated_from:"",arrested_investigated_to:"",limit:"",offset:""});async function C(){try{const a=await fetch($);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);i(T,await a.json())}catch(a){console.error("[GET] Error getting cybercrime data:",a)}}function oe(){i(q,!e(q)),i(x,!1),e(q)||(i(t,{from:"",to:"",year:"",autonomous_community:"",criminal_ofense:"",criminal_ofense_from:"",criminal_ofense_to:"",cybersecurity:"",cybersecurity_from:"",cybersecurity_to:"",arrested_investigated:"",arrested_investigated_from:"",arrested_investigated_to:"",limit:"",offset:""}),i(n,""),C())}function ie(){i(x,!e(x)),i(q,!1)}async function se(){const a=new URLSearchParams;for(const[r,d]of Object.entries(e(t)))d!==""&&d!==null&&d!==void 0&&a.append(r,d);try{const r=await fetch(`${$}?${a.toString()}`);if(!r.ok)throw new Error("No se pudieron obtener resultados");i(T,await r.json()),e(T).length===0?i(n,"No se encontraron resultados para los filtros aplicados."):i(n,`Se encontraron ${e(T).length} resultados.`),setTimeout(()=>i(n,""),3e3)}catch(r){i(n,`Error: ${r.message}`),setTimeout(()=>i(n,""),3e3),i(T,[])}}async function ne(){try{const a=await fetch($,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(f))}),r=await a.json();a.status===201?(i(n,"Registro creado correctamente"),i(x,!1),ce(),await C()):a.status===400?i(n,`Datos inválidos: ${r.error||"Revisa los campos."}`):a.status===409?i(n,"Ya existe un registro con esos identificadores."):i(n,`Error inesperado (${a.status}) al procesar la petición.`)}catch(a){console.error("[CREATE] Error:",a),i(n,"No se pudo conectar con el servidor.")}setTimeout(()=>i(n,""),5e3)}function ce(){i(f,{autonomous_community:"",year:"",criminal_ofense:"",cybersecurity:"",arrested_investigated:""})}async function le(){const a=`${$}/loadInitialData`;try{const r=await fetch(a);if(!r.ok)throw new Error(`Error ${r.status}`);i(n,"Datos iniciales cargados."),await C()}catch(r){console.error("[LOAD INITIAL DATA] Error:",r),i(n,"Error al cargar los datos iniciales.")}setTimeout(()=>{i(n,"")},3e3)}async function ue(){if(confirm("¿Estás seguro de que quieres eliminar todos los registros?")){try{const r=await fetch($,{method:"DELETE"});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);i(n,"Todos los registros han sido eliminados."),await C()}catch(r){console.error("[DELETE] Error deleting records:",r),i(n,"Error al eliminar los registros.")}setTimeout(()=>{i(n,"")},3e3)}}async function de(a,r){if(confirm(`¿Estás seguro de que quieres eliminar el registro de ${a} (${r})?`)){try{const _=await fetch(`${$}/${a}/${r}`,{method:"DELETE"});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);i(n,`Registro de ${a} (${r}) eliminado correctamente.`),await C()}catch(_){console.error("[DELETE ONE] Error deleting record:",_),i(n,"Error al eliminar el registro.")}setTimeout(()=>{i(n,"")},3e3)}}xe(async()=>{await C()}),Te();var S=qe();ve(a=>{he.title="Datos de Ciberdelincuencia"});var B=p(S),U=p(B);{var me=a=>{var r=ke(),d=p(r,!0);m(r),ee(()=>I(d,e(n))),we(3,r,()=>$e,()=>({duration:300})),j(a,r)};F(U,a=>{e(n)&&a(me)})}var H=o(U,2),z=o(p(H),2),G=p(z),J=o(G,2),M=o(J,2),fe=o(M,2);m(z),m(H);var Y=o(H,2);{var pe=a=>{var r=Ae(),d=p(r);l(d);var _=o(d,2);l(_);var y=o(_,2);l(y);var b=o(y,2);l(b);var h=o(b,2);l(h);var g=o(h,4);m(r),u(d,()=>e(f).autonomous_community,v=>c(f,e(f).autonomous_community=v)),u(_,()=>e(f).year,v=>c(f,e(f).year=v)),u(y,()=>e(f).criminal_ofense,v=>c(f,e(f).criminal_ofense=v)),u(b,()=>e(f).cybersecurity,v=>c(f,e(f).cybersecurity=v)),u(h,()=>e(f).arrested_investigated,v=>c(f,e(f).arrested_investigated=v)),E("click",g,()=>i(x,!1)),E("submit",r,te(ne)),j(a,r)};F(Y,a=>{e(x)&&a(pe)})}var K=o(Y,2);{var _e=a=>{var r=Re(),d=p(r);l(d);var _=o(d,2);l(_);var y=o(_,2);l(y);var b=o(y,2);l(b);var h=o(b,2);l(h);var g=o(h,2);l(g);var v=o(g,2);l(v);var D=o(v,2);l(D);var L=o(D,2);l(L);var w=o(L,2);l(w);var N=o(w,2);l(N);var k=o(N,2);l(k);var A=o(k,2);l(A);var P=o(A,2);l(P);var Z=o(P,2);l(Z),ge(2),m(r),u(d,()=>e(t).from,s=>c(t,e(t).from=s)),u(_,()=>e(t).to,s=>c(t,e(t).to=s)),u(y,()=>e(t).year,s=>c(t,e(t).year=s)),u(b,()=>e(t).autonomous_community,s=>c(t,e(t).autonomous_community=s)),u(h,()=>e(t).criminal_ofense,s=>c(t,e(t).criminal_ofense=s)),u(g,()=>e(t).criminal_ofense_from,s=>c(t,e(t).criminal_ofense_from=s)),u(v,()=>e(t).criminal_ofense_to,s=>c(t,e(t).criminal_ofense_to=s)),u(D,()=>e(t).cybersecurity,s=>c(t,e(t).cybersecurity=s)),u(L,()=>e(t).cybersecurity_from,s=>c(t,e(t).cybersecurity_from=s)),u(w,()=>e(t).cybersecurity_to,s=>c(t,e(t).cybersecurity_to=s)),u(N,()=>e(t).arrested_investigated,s=>c(t,e(t).arrested_investigated=s)),u(k,()=>e(t).arrested_investigated_from,s=>c(t,e(t).arrested_investigated_from=s)),u(A,()=>e(t).arrested_investigated_to,s=>c(t,e(t).arrested_investigated_to=s)),u(P,()=>e(t).limit,s=>c(t,e(t).limit=s)),u(Z,()=>e(t).offset,s=>c(t,e(t).offset=s)),E("submit",r,te(se)),j(a,r)};F(K,a=>{e(q)&&a(_e)})}var Q=o(K,4),V=o(p(Q),2),W=p(V),X=p(W);Ee(X,5,()=>e(T),De,(a,r)=>{var d=Ie(),_=p(d),y=p(_,!0);m(_);var b=o(_),h=p(b,!0);m(b);var g=o(b),v=p(g,!0);m(g);var D=o(g),L=p(D,!0);m(D);var w=o(D),N=p(w,!0);m(w);var k=o(w),A=p(k),P=o(A,2);m(k),m(d),ee(()=>{I(y,e(r).autonomous_community),I(h,e(r).year),I(v,e(r).criminal_ofense),I(L,e(r).cybersecurity),I(N,e(r).arrested_investigated)}),E("click",A,()=>Ce(`/cybercrime/edit/${encodeURIComponent(e(r).autonomous_community)}/${e(r).year}`)),E("click",P,()=>de(e(r).autonomous_community,e(r).year)),j(a,d)}),m(X),m(W),m(V),m(Q),m(B),m(S),E("click",G,oe),E("click",J,ie),E("click",M,le),E("click",fe,ue),j(re,S),ye()}export{Je as component};
