import{t as y,h as R,a as g}from"../chunks/BgiXASfF.js";import"../chunks/BIROYZXv.js";import{p as M,a as G,$ as Y,b as n,m as D,n as z,c as d,s as f,g as _,r as p,t as H}from"../chunks/CpQaROA0.js";import{s as U}from"../chunks/D1bc0aDY.js";import{i as F}from"../chunks/D1Iy4rpg.js";import{i as q}from"../chunks/CZQ4deT6.js";import{o as B}from"../chunks/BXqaL1Zo.js";var W=y('<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">',1),J=y("<p>Cargando datos...</p>"),K=y('<p style="color: red"> </p>'),Q=y('<div class="wrapper"><div class="container"><h2>Integración grupal</h2> <hr style="width: 100%; animation: loadHrGraph 1s;"> <div class="graph-container"><p>Esta gráfica integra los datos de las tres APIs. En concreto, se muestra el porcentaje de empleo, educación superior y cibercrimen por años.</p> <figure class="highcharts-figure svelte-t3krpg"><div id="container"></div> <!> <!></figure></div></div></div>');function re(j,O){M(O,!1);let E="/api/v1/employment-data?autonomous_community=TOTAL&education_level=TOTAL",T="/api/v1/education-data?autonomous_community=TOTAL",x="/api/v1/cybercrime-data?autonomous_community=TOTAL",h=[],m=[],u=[],v=[],b=D(!0),i=D("");function c(e){return new Promise((t,a)=>{if(document.querySelector(`script[src="${e}"]`))return t();const o=document.createElement("script");o.src=e,o.onload=t,o.onerror=a,document.head.appendChild(o)})}async function C(){n(b,!0),n(i,"");try{console.log(`Solicitando datos a: ${E}`);const e=await fetch(E,{method:"GET"});if(!e.ok)throw new Error(`Error en la respuesta: ${e.status}`);console.log(`Solicitando datos a: ${T}`);const t=await fetch(T,{method:"GET"});if(!t.ok)throw new Error(`Error en la respuesta: ${t.status}`);console.log(`Solicitando datos a: ${x}`);const a=await fetch(x,{method:"GET"});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);h=await e.json(),console.log(`Datos recibidos: ${h.length} registros`),m=await t.json(),console.log(`Datos recibidos: ${m.length} registros`),u=await a.json(),console.log(`Datos recibidos: ${u.length} registros`);const s=[...new Set(h.map(r=>r.year))],o=[...new Set(m.map(r=>r.year))],l=[...new Set(u.map(r=>r.year))];v=[...new Set([...s,...o,...l])].sort(),I()}catch(e){console.error(`ERROR fetching data: ${e}`),n(i,`Error loading data: ${e.message}`)}finally{n(b,!1)}}function I(){if(v.length===0){console.log("No hay datos disponibles"),n(i,"No hay datos disponibles");return}const e=[];if(v.forEach(t=>{const a=h.find(r=>r.year===t&&r.education_level==="TOTAL"),s=m.find(r=>r.year===t),o=u.find(r=>r.year===t);let l=null;o&&!isNaN(parseFloat(o.cybersecurity))&&!isNaN(parseFloat(o.criminal_ofense))&&parseFloat(o.criminal_ofense)>0&&(l=parseFloat(o.cybersecurity)/parseFloat(o.criminal_ofense)*100),e.push({name:t.toString(),data:[a&&!isNaN(a.employment_rate)?parseFloat(a.employment_rate):null,s&&!isNaN(s.higher_grade)?parseFloat(s.higher_grade):null,l??null]}),console.log({year:t,emp:a==null?void 0:a.employment_rate,edu:s==null?void 0:s.higher_grade,cyb:o,cybSecurityPercentage:l})}),e.length===0||e.every(t=>t.data.every(a=>a===null))){console.error("No hay datos válidos para visualizar"),n(i,"No hay datos válidos para visualizar");return}Highcharts.chart("container",{chart:{type:"column"},title:{text:"Datos Integrados",align:"left",style:{fontSize:"1.2em"}},subtitle:{text:"Comparativa por años en España"},xAxis:{categories:["Tasa de Empleo","Educación Superior","Tasa de cibercrimen"],crosshair:!0},yAxis:{min:0,max:100,title:{text:"Porcentaje"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.2f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{grouping:!0,shadow:!1,borderWidth:0}},legend:{align:"right",verticalAlign:"top",floating:!0,backgroundColor:"white",shadow:!1},series:e,colors:["#5f4b8b","#e0bbff","#88c0d0","#4c566a","#bf616a","#a3be8c","#ebcb8b","#d08770","#b48ead"],credits:{enabled:!1}})}B(async()=>{try{await c("https://code.highcharts.com/highcharts.js"),await c("https://code.highcharts.com/modules/heatmap.js"),await c("https://code.highcharts.com/modules/exporting.js"),await c("https://code.highcharts.com/modules/export-data.js"),await c("https://code.highcharts.com/modules/accessibility.js"),await C()}catch(e){n(i,`Error cargando scripts de Highcharts: ${e}`),console.error(e)}}),q();var w=Q();R(e=>{var t=W();Y.title="Graphs - Analytics",z(2),g(e,t)});var $=d(w),A=f(d($),4),N=f(d(A),2),S=f(d(N),2);{var P=e=>{var t=J();g(e,t)};F(S,e=>{_(b)&&e(P)})}var k=f(S,2);{var L=e=>{var t=K(),a=d(t,!0);p(t),H(()=>U(a,_(i))),g(e,t)};F(k,e=>{_(i)&&e(L)})}p(N),p(A),p($),p(w),g(j,w),G()}export{re as component};
