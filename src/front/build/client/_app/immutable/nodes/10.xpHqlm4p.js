import{t as v,a as u}from"../chunks/AwDElgrE.js";import"../chunks/RXuRlTD1.js";import{v as V,x as y,b as r,w as J,s as m,c as l,h as i,m as b,B as Q,r as n}from"../chunks/DqzT7aWf.js";import{e as Y,s as G}from"../chunks/BjFHoynf.js";import{i as w}from"../chunks/dUYLJQ_5.js";import{e as Z,i as K}from"../chunks/D_N7JuGC.js";import{s as X}from"../chunks/Dxge3KwP.js";import{b as aa}from"../chunks/DOEI6xEw.js";import{i as ea}from"../chunks/Dz9YM5No.js";import{o as ta}from"../chunks/S0sOL0db.js";var oa=v("<option> </option>"),ra=v("<p>Cargando datos...</p>"),ia=v('<p style="color: red"> </p>'),sa=v('<img alt="Gráfica de tasa de paro">'),na=v('<div class="wrapper"><div class="container"><h2>Gráficas de employment-data</h2> <hr> <div class="graph-container"><h3>Selecciona la comunidad autónmoma:</h3> <select class="custom-select"></select></div> <div class="article"><h3>Gráfica de la tasa de empleo</h3> <p>Esta gráfica permite visualizar los datos de empleo por año y nivel educativo. Puedes seleccionar la comunidad autónoma en específico.</p></div> <div class="graph-container"><figure class="highcharts-figure svelte-t3krpg"><div id="container"></div> <!> <!></figure></div> <div class="article"><h3>Gráfica de la tasa de paro</h3> <p>Esta gráfica permite visualizar la tasa de paro por años según la comunidad autónoma elegida.</p></div> <div class="graph-container"><!></div></div></div>');function ya(P,B){V(B,!1);let M="/api/v1/employment-data",p=[],_=["INF","SEC","SUP","TOTAL"],g=[],x=b(!0),c=b("");const R=["Andalucía","Aragón","Asturias","Baleares","Canarias","Cantabria","Castilla-La Mancha","Castilla y León","Cataluña","Comunitat Valenciana","Extremadura","Galicia","Madrid","Murcia","Navarra","País Vasco","La Rioja","Ceuta y Melilla","TOTAL"];let C=b(""),d=b("Andalucía");function h(a){return new Promise((e,o)=>{if(document.querySelector(`script[src="${a}"]`))return e();const t=document.createElement("script");t.src=a,t.onload=e,t.onerror=o,document.head.appendChild(t)})}async function T(){i(x,!0),i(c,"");const a=`${M}?autonomous_community=${encodeURIComponent(r(d))}`;try{console.log(`Solicitando datos a: ${a}`);const e=await fetch(a,{method:"GET"});if(!e.ok)throw new Error(`Error en la respuesta: ${e.status}`);p=await e.json(),console.log(`Datos recibidos: ${p.length} registros para ${r(d)}`),g=[...new Set(p.map(s=>s.year))].sort(),z(),I()}catch(e){console.error(`ERROR al obtener datos de ${a}: ${e}`),i(c,`Error al cargar datos: ${e.message}`)}finally{i(x,!1)}}function z(){if(p.length===0){console.log("No hay datos para mostrar"),i(c,"No hay datos disponibles para la comunidad seleccionada");return}const a=[];if(_.forEach((e,o)=>{g.forEach((s,t)=>{const L=p.find(O=>O.education_level===e&&O.year===s);L&&a.push([t,o,L.employment_rate])})}),a.length===0){console.error("No se encontraron puntos de datos para el gráfico"),i(c,"No hay datos disponibles para generar el gráfico para la comunidad seleccionada");return}console.log(`Generando gráfico con ${a.length} puntos de datos`),Highcharts.chart("container",{chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1},title:{text:`Tasa de empleo por nivel educativo en ${r(d)}`,style:{fontSize:"1.2em"}},xAxis:{categories:g.map(String),title:{text:"Año"}},yAxis:{categories:_,title:{text:"Nivel Educativo"},reversed:!0},colorAxis:{min:40,max:100,minColor:"#e0bbff",maxColor:"#5f4b8b"},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter(){return`<b>Año: ${g[this.point.x]}</b><br><b>Nivel educativo: ${_[this.point.y]}</b><br><b>Tasa de empleo: ${this.point.value.toFixed(2)}%</b>`}},series:[{name:"Tasa de empleo",borderWidth:0,data:a,dataLabels:{enabled:!0,color:"#ffffff"}}],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{yAxis:{labels:{style:{fontSize:"10px"}}},legend:{align:"center",verticalAlign:"bottom",layout:"horizontal",y:0}}}]}})}function D(){i(c,""),T()}function I(){const a={};p.forEach(t=>{t.education_level==="TOTAL"&&!a[t.year]&&(a[t.year]=t.unemployment_rate)});const e=Object.keys(a),o=Object.values(a).map(t=>parseFloat(t.toFixed(2))),s={type:"bar",data:{labels:e,datasets:[{label:"Tasa de paro (%)",data:o,backgroundColor:"rgba(138, 43, 226, 0.7)"}]},options:{title:{display:!0,text:`Tasa de paro en ${r(d)} por año`},scales:{yAxes:[{ticks:{beginAtZero:!0,max:30}}]}}};i(C,`https://quickchart.io/chart?w=500&h=300&c=${encodeURIComponent(JSON.stringify(s))}`)}ta(async()=>{try{await h("https://code.highcharts.com/highcharts.js"),await h("https://code.highcharts.com/modules/heatmap.js"),await h("https://code.highcharts.com/modules/exporting.js"),await h("https://code.highcharts.com/modules/export-data.js"),await h("https://code.highcharts.com/modules/accessibility.js"),await T()}catch(a){i(c,`Error cargando scripts de Highcharts: ${a}`),console.error(a)}}),ea();var A=na(),S=l(A),$=m(l(S),4),f=m(l($),2);y(()=>{r(d),Q(()=>{})}),Z(f,5,()=>R,K,(a,e)=>{var o=oa(),s={},t=l(o,!0);n(o),y(()=>{s!==(s=r(e))&&(o.value=(o.__value=r(e))??""),G(t,r(e))}),u(a,o)}),n(f),n($);var E=m($,4),j=l(E),k=m(l(j),2);{var U=a=>{var e=ra();u(a,e)};w(k,a=>{r(x)&&a(U)})}var F=m(k,2);{var q=a=>{var e=ia(),o=l(e,!0);n(e),y(()=>G(o,r(c))),u(a,e)};w(F,a=>{r(c)&&a(q)})}n(j),n(E);var N=m(E,4),H=l(N);{var W=a=>{var e=sa();y(()=>X(e,"src",r(C))),u(a,e)};w(H,a=>{r(C)&&a(W)})}n(N),n(S),n(A),aa(f,()=>r(d),a=>i(d,a)),Y("change",f,D),u(P,A),J()}export{ya as component};
