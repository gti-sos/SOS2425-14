import{t as v,a as g}from"../chunks/C0k3Nw9y.js";import"../chunks/DPNYAhEg.js";import{v as C,w as G,s as m,c as l,h as i,m as D,b as f,r as d,x as I}from"../chunks/cdyx5pLP.js";import{s as P}from"../chunks/dBgfGCkZ.js";import{i as E}from"../chunks/CEmQKR9v.js";import{i as R}from"../chunks/BZ6f0h1O.js";import{o as z}from"../chunks/CV6rVgxM.js";var F=v("<p>Cargando datos...</p>"),H=v('<p style="color: red"> </p>'),L=v('<div class="wrapper"><div class="container"><h2>Integraciones</h2> <hr> <div class="article"><h3>Distribución de ayudas DANA por municipios</h3></div> <div class="graph-container"><figure class="highcharts-figure svelte-t3krpg"><div id="container"></div> <!> <!></figure></div></div></div>');function U(S,j){C(j,!1);const y="https://sos2425-18.onrender.com/api/v2/dana-grants-subsidies-stats";let r=[],p=D(!0),s=D("");function c(t){return new Promise((a,n)=>{if(document.querySelector(`script[src="${t}"]`))return a();const e=document.createElement("script");e.src=t,e.onload=a,e.onerror=n,document.head.appendChild(e)})}async function $(){i(p,!0),i(s,"");try{console.log(`Solicitando datos a: ${y}`);const t=await fetch(y,{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Error en la respuesta: ${t.status}`);r=await t.json(),console.log(`Datos recibidos: ${r.length} registros`),console.log("Muestra de datos:",r.slice(0,2)),A()}catch(t){console.error(`ERROR al obtener datos: ${t}`),i(s,`Error al cargar datos: ${t.message}`)}finally{i(p,!1)}}function A(){if(!r||r.length===0){console.log("No hay datos para mostrar"),i(s,"No hay datos disponibles");return}console.log("Estructura de los primeros datos:",JSON.stringify(r[0],null,2));const t={};r.forEach(o=>{const e=o.mun_name,h=o.amt_granted;t[e]||(t[e]=0),t[e]+=h}),console.log("Datos agrupados por municipio:",t);const a=Object.entries(t).map(([o,e])=>({name:o,y:e})).sort((o,e)=>e.y-o.y);if(console.log("Datos preparados para el gráfico:",a),a.length===0){i(s,"No se pudieron encontrar datos válidos de municipios y cantidades");return}let n=a.slice(0,10);if(a.length>10){const e=a.slice(10).reduce((h,k)=>h+k.y,0);n.push({name:"Otros municipios",y:e})}Highcharts.chart("container",{chart:{type:"pie",backgroundColor:"rgba(255, 255, 255, 0.8)"},title:{text:"Distribución de ayudas por municipios",align:"center",style:{fontWeight:"bold",fontSize:"18px"}},subtitle:{text:"Fuente: G18-dana-grants-subsidies-stats",align:"center"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f}%",style:{fontSize:"12px"}},showInLegend:!0}},tooltip:{pointFormat:"{series.name}: <b>{point.y:.0f}€</b> ({point.percentage:.1f}%)"},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle"},accessibility:{point:{valueSuffix:"€"}},series:[{name:"Importe total",colorByPoint:!0,data:n}],credits:{enabled:!0,text:"G18-dana-grants-subsidies-stats"}})}z(async()=>{try{await c("https://code.highcharts.com/highcharts.js"),await c("https://code.highcharts.com/modules/heatmap.js"),await c("https://code.highcharts.com/modules/exporting.js"),await c("https://code.highcharts.com/modules/export-data.js"),await c("https://code.highcharts.com/modules/accessibility.js"),await $()}catch(t){i(s,`Error cargando scripts de Highcharts: ${t}`),console.error(t)}}),R();var u=L(),b=l(u),w=m(l(b),6),x=l(w),_=m(l(x),2);{var M=t=>{var a=F();g(t,a)};E(_,t=>{f(p)&&t(M)})}var N=m(_,2);{var O=t=>{var a=H(),n=l(a,!0);d(a),I(()=>P(n,f(s))),g(t,a)};E(N,t=>{f(s)&&t(O)})}d(x),d(w),d(b),d(u),g(S,u),G()}export{U as component};
