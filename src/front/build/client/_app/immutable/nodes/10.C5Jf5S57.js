import{t as u,h as H,a as m,b as V}from"../chunks/CSKOCQES.js";import"../chunks/Cy4xcxr7.js";import{v as J,x as f,b as t,w as Q,s as h,c,h as i,m as y,n as Y,B as Z,r as s}from"../chunks/BGtGGxyh.js";import{e as K,s as O}from"../chunks/D3YLEh_f.js";import{i as E}from"../chunks/C4thPrJc.js";import{e as X,i as aa}from"../chunks/VAEyCMlk.js";import{s as ea}from"../chunks/DUt1lFDs.js";import{b as ta}from"../chunks/Baslegig.js";import{i as oa}from"../chunks/Dx5kRWrQ.js";import{o as ra}from"../chunks/Dy25ky0p.js";var ia=V('<script src="https://code.highcharts.com/highcharts.js"><\/script> <script src="https://code.highcharts.com/modules/heatmap.js"><\/script> <script src="https://code.highcharts.com/modules/exporting.js"><\/script> <script src="https://code.highcharts.com/modules/export-data.js"><\/script> <script src="https://code.highcharts.com/modules/accessibility.js"><\/script>',1),sa=u("<option> </option>"),na=u("<p>Cargando datos...</p>"),ca=u('<p style="color: red"> </p>'),la=u('<img alt="Gráfica de tasa de paro">'),da=u('<div class="wrapper"><div class="container"><h2>Gráficas de employment-data</h2> <hr> <div class="graph-container"><h3>Selecciona la comunidad autónmoma:</h3> <select class="custom-select"></select></div> <div class="article"><h3>Gráfica de la tasa de empleo</h3> <p>Esta gráfica permite visualizar los datos de empleo por año y nivel educativo. Puedes seleccionar la comunidad autónoma en específico.</p></div> <div class="graph-container"><figure class="highcharts-figure svelte-t3krpg"><div id="container"></div> <!> <!></figure></div> <div class="article"><h3>Gráfica de la tasa de paro</h3> <p>Esta gráfica permite visualizar la tasa de paro por años según la comunidad autónoma elegida.</p></div> <div class="graph-container"><!></div></div></div>');function xa(G,B){J(B,!1);let M="/api/v1/employment-data",p=[],b=["INF","SEC","SUP","TOTAL"],v=[],_=y(!0),l=y("");const P=["Andalucía","Aragón","Asturias","Baleares","Canarias","Cantabria","Castilla-La Mancha","Castilla y León","Cataluña","Comunitat Valenciana","Extremadura","Galicia","Madrid","Murcia","Navarra","País Vasco","La Rioja","Ceuta y Melilla","TOTAL"];let x=y(""),d=y("Andalucía");async function T(){i(_,!0),i(l,"");const a=`${M}?autonomous_community=${encodeURIComponent(t(d))}`;try{console.log(`Solicitando datos a: ${a}`);const e=await fetch(a,{method:"GET"});if(!e.ok)throw new Error(`Error en la respuesta: ${e.status}`);p=await e.json(),console.log(`Datos recibidos: ${p.length} registros para ${t(d)}`),v=[...new Set(p.map(n=>n.year))].sort(),R(),D()}catch(e){console.error(`ERROR al obtener datos de ${a}: ${e}`),i(l,`Error al cargar datos: ${e.message}`)}finally{i(_,!1)}}function R(){if(p.length===0){console.log("No hay datos para mostrar"),i(l,"No hay datos disponibles para la comunidad seleccionada");return}const a=[];if(b.forEach((e,o)=>{v.forEach((n,r)=>{const N=p.find(L=>L.education_level===e&&L.year===n);N&&a.push([r,o,N.employment_rate])})}),a.length===0){console.error("No se encontraron puntos de datos para el gráfico"),i(l,"No hay datos disponibles para generar el gráfico para la comunidad seleccionada");return}console.log(`Generando gráfico con ${a.length} puntos de datos`),Highcharts.chart("container",{chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1},title:{text:`Tasa de empleo por nivel educativo en ${t(d)}`,style:{fontSize:"1.2em"}},xAxis:{categories:v.map(String),title:{text:"Año"}},yAxis:{categories:b,title:{text:"Nivel Educativo"},reversed:!0},colorAxis:{min:40,max:100,minColor:"#e0bbff",maxColor:"#5f4b8b"},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter(){return`<b>Año: ${v[this.point.x]}</b><br><b>Nivel educativo: ${b[this.point.y]}</b><br><b>Tasa de empleo: ${this.point.value.toFixed(2)}%</b>`}},series:[{name:"Tasa de empleo",borderWidth:0,data:a,dataLabels:{enabled:!0,color:"#ffffff"}}],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{yAxis:{labels:{style:{fontSize:"10px"}}},legend:{align:"center",verticalAlign:"bottom",layout:"horizontal",y:0}}}]}})}function z(){i(l,""),T()}function D(){const a={};p.forEach(r=>{r.education_level==="TOTAL"&&!a[r.year]&&(a[r.year]=r.unemployment_rate)});const e=Object.keys(a),o=Object.values(a).map(r=>parseFloat(r.toFixed(2))),n={type:"bar",data:{labels:e,datasets:[{label:"Tasa de paro (%)",data:o,backgroundColor:"rgba(138, 43, 226, 0.7)"}]},options:{title:{display:!0,text:`Tasa de paro en ${t(d)} por año`},scales:{yAxes:[{ticks:{beginAtZero:!0,max:30}}]}}};i(x,`https://quickchart.io/chart?w=500&h=300&c=${encodeURIComponent(JSON.stringify(n))}`)}ra(async()=>{await T()}),oa();var C=da();H(a=>{var e=ia();Y(8),m(a,e)});var w=c(C),A=h(c(w),4),g=h(c(A),2);f(()=>{t(d),Z(()=>{})}),X(g,5,()=>P,aa,(a,e)=>{var o=sa(),n={},r=c(o,!0);s(o),f(()=>{n!==(n=t(e))&&(o.value=(o.__value=t(e))??""),O(r,t(e))}),m(a,o)}),s(g),s(A);var $=h(A,4),S=c($),j=h(c(S),2);{var I=a=>{var e=na();m(a,e)};E(j,a=>{t(_)&&a(I)})}var U=h(j,2);{var F=a=>{var e=ca(),o=c(e,!0);s(e),f(()=>O(o,t(l))),m(a,e)};E(U,a=>{t(l)&&a(F)})}s(S),s($);var k=h($,4),W=c(k);{var q=a=>{var e=la();f(()=>ea(e,"src",t(x))),m(a,e)};E(W,a=>{t(x)&&a(q)})}s(k),s(w),s(C),ta(g,()=>t(d),a=>i(d,a)),K("change",g,z),m(G,C),Q()}export{xa as component};
