import{t as v,h as ha,a as f}from"../chunks/CcBKTLYU.js";import"../chunks/BQvSbhnN.js";import{p as fa,t as G,a as va,$ as ga,s as l,c as u,b as n,m as S,n as ya,g as d,r as m,aw as Y}from"../chunks/B9KnJm2w.js";import{s as O}from"../chunks/b-klYKnl.js";import{i as w}from"../chunks/DRx51zI4.js";import{s as C}from"../chunks/D_AC4_dt.js";import{t as ba,f as _a}from"../chunks/PRg3Qw8M.js";import{i as wa}from"../chunks/B7KipWS9.js";import{o as Ea}from"../chunks/BKuOihLL.js";var Ca=v('<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">',1),xa=v("<p>Cargando datos...</p>"),Da=v('<p style="color: red"> </p>'),ja=v('<div class="loading">Cargando datos...</div>'),Aa=v('<div class="error"> </div>'),Ga=v('<canvas id="chart10" width="800" height="400" class="svelte-1dhmy21"></canvas>'),ka=v('<div class="loading">Cargando datos...</div>'),Na=v('<div class="error"> </div>'),Ia=v('<canvas id="andaluciaChart" width="800" height="400" class="svelte-1dhmy21"></canvas>'),Ra=v('<div class="wrapper"><div class="container"><h2 style="text-align: center;">Integraciones <br><i>Jaime Duffy Panés</i></h2> <hr style="width: 100%; animation: loadHrGraph 1s; transition: all 0.3s ease;"> <div><div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Distribución de ayudas DANA por municipios</h3> <p>Este gráfico representa cómo se reparte la ayuda por la dana para cada municipio.</p> <a style="color: #fff;" target="_blank"><i>G18-dana-grants-subsidies-stats</i></a> <figure class="highcharts-figure"><div id="container"></div> <!> <!></figure></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Integración: Número de multas por tasa de paro</h3> <p>Este gráfico nos muestra el número de multas de las comunidades autónomas junto con la tasa de paro.</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G10-radars-stats</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container svelte-1dhmy21"><!></div></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Integración: Número de proyectos y tasa de actividad</h3> <p>Este gráfico mustra el numero de proyectos y la tasa de actividad en andalucía según los años.</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G13-water-supply-improvements</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container svelte-1dhmy21"><!></div></div></div></div></div>');function Ha(K,Q){fa(Q,!1);const k="https://sos2425-18.onrender.com/api/v2/dana-grants-subsidies-stats",E="https://sos2425-13.onrender.com/api/v1/water-supply-improvements",N="https://sos2425-10.onrender.com/api/v1/radars-stats";let x=S("/api/v1/employment-data"),D=[],y=[],j=[],A=[],I=[],h=S(!0),c=S("");function b(a){return new Promise((e,r)=>{if(document.querySelector(`script[src="${a}"]`))return e();const o=document.createElement("script");o.src=a,o.onload=e,o.onerror=r,document.head.appendChild(o)})}async function V(){n(h,!0),n(c,""),D=[],I=[];try{let a=await fetch(d(x),{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);I=await a.json(),console.log(`Solicitando datos a: ${E}`);let r=await fetch(E,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`Error en la respuesta: ${r.status}`);let s=await r.json();if(s.length===0){if(console.warn("No hay datos. Cargando datos iniciales..."),!(await fetch(`${E}/loadInitialData`,{method:"GET"})).ok)throw new Error("No se pudo cargar datos iniciales");if(await new Promise(t=>setTimeout(t,1e3)),r=await fetch(E,{method:"GET",headers:{Accept:"application/json"}}),!r.ok)throw new Error("Error al obtener datos tras la carga inicial");s=await r.json()}D=s,console.log(`Datos recibidos: ${D.length} registros`),ea()}catch(a){console.error(`ERROR G13: ${a}`),n(c,`Error al cargar datos G13: ${a.message}`)}finally{n(h,!1)}}async function X(){n(h,!0),n(c,""),y=[],A=[];try{let a=await fetch(d(x),{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);A=await a.json(),console.log(`Solicitando datos a: ${N}`);const r=await fetch(N,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`Error en la respuesta: ${r.status}`);y=await r.json(),console.log(`Datos recibidos: ${y.length} registros`),oa()}catch(a){console.error(`ERROR G10: ${a}`),n(c,`Error al cargar datos G10: ${a.message}`),n(h,!1)}}async function aa(){n(h,!0),n(c,"");try{console.log(`Solicitando datos a: ${k}`);const a=await fetch(k,{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);j=await a.json(),console.log(`Datos recibidos: ${j.length} registros`),ta()}catch(a){console.error(`ERROR al obtener datos: ${a}`),n(c,`Error al cargar datos: ${a.message}`)}finally{n(h,!1)}}function ta(){console.log("Estructura de los primeros datos:",JSON.stringify(j[0],null,2));const a={};j.forEach(s=>{const o=s.mun_name,t=s.amt_granted;a[o]||(a[o]=0),a[o]+=t}),console.log("Datos agrupados por municipio:",a);const e=Object.entries(a).map(([s,o])=>({name:s,y:o})).sort((s,o)=>o.y-s.y);if(console.log("Datos preparados para el gráfico:",e),e.length===0){n(c,"No se pudieron encontrar datos válidos de municipios y cantidades");return}let r=e.slice(0,10);if(e.length>10){const o=e.slice(10).reduce((t,i)=>t+i.y,0);r.push({name:"Otros municipios",y:o})}Highcharts.chart("container",{chart:{type:"pie",backgroundColor:"rgba(255, 255, 255, 0.8)"},title:{text:"Distribución de ayudas por municipios",align:"center",style:{fontWeight:"bold",fontSize:"18px"}},subtitle:{text:"Fuente: G18-dana-grants-subsidies-stats",align:"center"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f}%",style:{fontSize:"12px"}},showInLegend:!0}},tooltip:{pointFormat:"{series.name}: <b>{point.y:.0f}€</b> ({point.percentage:.1f}%)"},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle"},accessibility:{point:{valueSuffix:"€"}},series:[{name:"Importe total",colorByPoint:!0,data:r}],credits:{enabled:!0,text:"G18-dana-grants-subsidies-stats"}})}async function ea(){await Y();const a={};I.forEach(t=>{var i;if(((i=t.autonomous_community)==null?void 0:i.toLowerCase())==="andalucía"&&t.education_level==="TOTAL"){const p=t.year.toString();a[p]||(a[p]={activity_rate:null,project_count:null}),a[p].activity_rate=t.activity_rate}}),D.forEach(t=>{var i,p;if(((i=t.autonomous_community)==null?void 0:i.toLowerCase())==="andalucía"||((p=t.autonomous_community)==null?void 0:p.toLowerCase())==="andalucia"){const _=t.year.toString();a[_]||(a[_]={activity_rate:null,project_count:null}),a[_].project_count=t.project_count}});const e=Object.keys(a).sort(),r=e.map(t=>a[t].activity_rate),s=e.map(t=>a[t].project_count),o=document.getElementById("andaluciaChart");if(!o){console.error("No se encontró el canvas 'andaluciaChart'");return}console.log("Datos del gráfico:",r,s),new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Tasa de Actividad (%)",data:r,backgroundColor:"rgba(255, 99, 132, 0.8)",borderColor:"rgb(255, 99, 132)",borderWidth:1},{label:"Número de Proyectos",data:s,backgroundColor:"rgba(54, 162, 235, 0.8)",borderColor:"rgb(54, 162, 235)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Datos de Andalucía por Año",font:{weight:"bold",size:18}},subtitle:{display:!0,text:"Fuente: API G13 y API Empleo"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:10,font:{size:12}}}}}})}async function oa(){n(h,!1),await Y();const a=document.getElementById("chart10");if(!a){console.error("No se encontró el canvas 'chart10'");return}const e=a.getContext("2d");if(!e){console.error("No se pudo obtener el contexto 2D del canvas");return}if(y.length===0||A.length===0){n(c,"No hay datos disponibles para mostrar el gráfico");return}const r={Madrid:"Madrid (Comunidad de)",Navarra:"Navarra (Comunidad Foral de)"};function s(i){return r[i]||i}const o=[...new Set(y.map(i=>s(i.autonomousCommunity)))],t=[];o.forEach(i=>{const p=y.filter(g=>s(g.autonomousCommunity)===i).reduce((g,ma)=>g+(ma.complaint||0),0),_=A.find(g=>s(g.autonomous_community)===i&&g.year===2023&&g.education_level==="TOTAL");_&&t.push({x:p,y:_.unemployment_rate,community:i})}),new Chart(e,{type:"scatter",data:{datasets:[{label:"Tasa de paro vs. Número de multas por Comunidad",data:t,backgroundColor:"rgba(75, 192, 192, 0.7)",borderColor:"rgba(75, 192, 192, 1)",pointRadius:8,pointHoverRadius:12}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label(i){const p=i.raw;return`${p.community}: ${p.x} multas, ${p.y}% paro`}}},legend:{position:"top"},title:{display:!0,text:"Relación entre tasa de paro (2023) y número de multas por Comunidad Autónoma"}},scales:{x:{title:{display:!0,text:"Número de multas"},beginAtZero:!0},y:{title:{display:!0,text:"Tasa de paro (%)"},beginAtZero:!0}}}}),console.log("Datos del gráfico:",t)}Ea(async()=>{try{await b("https://code.highcharts.com/highcharts.js"),await b("https://code.highcharts.com/modules/heatmap.js"),await b("https://code.highcharts.com/modules/exporting.js"),await b("https://code.highcharts.com/modules/export-data.js"),await b("https://code.highcharts.com/modules/accessibility.js"),await b("https://cdn.jsdelivr.net/npm/chart.js"),await aa(),await V(),await X()}catch(a){n(c,`Error cargando scripts de Highcharts: ${a}`),console.error(a)}}),wa();var R=Ra();ha(a=>{var e=Ca();ga.title="Integrations - Jaime Duffy Panés",ya(2),f(a,e)});var z=u(R),T=l(u(z),4),$=u(T),L=l(u($),4);C(L,"href",k);var M=l(L,2),F=l(u(M),2);{var ra=a=>{var e=xa();f(a,e)};w(F,a=>{d(h)&&a(ra)})}var sa=l(F,2);{var ia=a=>{var e=Da(),r=u(e,!0);m(e),G(()=>O(r,d(c))),f(a,e)};w(sa,a=>{d(c)&&a(ia)})}m(M),m($);var P=l($,2),H=l(u(P),4);C(H,"href",N);var B=l(H,2),J=l(B,2),na=u(J);{var ca=a=>{var e=ja();f(a,e)},la=(a,e)=>{{var r=o=>{var t=Aa(),i=u(t,!0);m(t),G(()=>O(i,d(c))),f(o,t)},s=o=>{var t=Ga();f(o,t)};w(a,o=>{d(c)?o(r):o(s,!1)},e)}};w(na,a=>{d(h)?a(ca):a(la,!1)})}m(J),m(P);var W=l(P,2),Z=l(u(W),4);C(Z,"href",E);var q=l(Z,2),U=l(q,2),da=u(U);{var pa=a=>{var e=ka();f(a,e)},ua=(a,e)=>{{var r=o=>{var t=Na(),i=u(t,!0);m(t),G(()=>O(i,d(c))),f(o,t)},s=o=>{var t=Ia();f(o,t)};w(a,o=>{d(c)?o(r):o(s,!1)},e)}};w(da,a=>{d(h)?a(pa):a(ua,!1)})}m(U),m(W),m(T),m(z),m(R),G(()=>{C(B,"href",d(x)),C(q,"href",d(x))}),ba(3,T,()=>_a,()=>({duration:400})),f(K,R),va()}export{Ha as component};
