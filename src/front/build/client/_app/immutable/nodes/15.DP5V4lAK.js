import{t as v,h as Aa,a as p}from"../chunks/ptceg1cD.js";import"../chunks/DYGEi518.js";import{p as Da,t as b,a as Ia,$ as ja,s as e,c as n,b as u,m as R,n as Ga,g as s,r as c,ae as Pa}from"../chunks/Bf3qYDOT.js";import{s as C}from"../chunks/Cth4LdjJ.js";import{i as m}from"../chunks/B92dkHn0.js";import{s as g}from"../chunks/CtcqVrMc.js";import{t as ka,f as Sa}from"../chunks/PKZB5A62.js";import{i as Ta}from"../chunks/Omdg4Fwb.js";import{o as Oa}from"../chunks/B4XAmYv8.js";var Ra=v('<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">',1),$a=v("<p>Cargando datos...</p>"),Na=v('<p style="color: red"> </p>'),za=v("<p>Cargando datos...</p>"),La=v('<p style="color: red"> </p>'),Ma=v("<p>Cargando datos...</p>"),Fa=v('<p style="color: red"> </p>'),Wa=v('<div class="loading">Cargando datos...</div>'),Ha=v('<div class="error"> </div>'),Ja=v('<canvas id="andaluciaChart"></canvas>'),Ua=v("<p>Cargando datos...</p>"),Ba=v('<p style="color: red"> </p>'),qa=v(`<div class="wrapper"><div class="container"><h2 style="text-align: center;">Integraciones <br><i>Jaime Duffy Panés</i></h2> <hr style="width: 100%; animation: loadHrGraph 1s; transition: all 0.3s ease;"> <div><div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Distribución de ayudas DANA por municipios</h3> <p>Este gráfico representa cómo se reparte la ayuda por la dana para cada municipio.</p> <a style="color: #fff;" target="_blank"><i>G18-dana-grants-subsidies-stats</i></a> <figure class="highcharts-figure"><div id="container"></div> <!> <!></figure></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Integración: Comparativa de población activa y población dependiente</h3> <p>Este gráfico muestra la comparación entre la población dependiente (API G11) y la 
                    población activa para Andalucía, Cataluña y Aragón en el año 2024.</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G11-autonomy-dependence-applications</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container"><div id="combinedChart"></div> <!> <!></div></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Integración: TITULO</h3> <p>DESCRIPCION</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G10-radars-stats</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container"><div id="combinedChart"></div> <!> <!></div></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Integración: Número de proyectos y tasa de actividad</h3> <p>Este gráfico mustra el numero de proyectos y la tasa de actividad en andalucía según los años.</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G13-water-supply-improvements</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container"><!></div></div> <div class="article"><h3 style="font-size: 1.5em; text-transform: none;">Widget: TITULO</h3> <p>DESCRIPCION</p> <a style="color: #fff; margin-right: 1rem;" target="_blank"><i>G10-radars-stats</i></a> <a style="color: #fff;" target="_blank"><i>API: Datos de Empleo</i></a> <div class="chart-container"><div id="combinedChart"></div> <!> <!></div></div></div></div></div>`);function rt(ra,oa){Da(oa,!1);const D="https://sos2425-18.onrender.com/api/v2/dana-grants-subsidies-stats",ia="https://sos2425-11.onrender.com/api/v1/autonomy-dependence-applications",w="https://sos2425-13.onrender.com/api/v1/water-supply-improvements",$="https://sos2425-10.onrender.com/api/v1/radars-stats";let E=R("/api/v1/employment-data"),x=[],A=[],I=[],f=R(!0),l=R("");function _(a){return new Promise((t,i)=>{if(document.querySelector(`script[src="${a}"]`))return t();const r=document.createElement("script");r.src=a,r.onload=t,r.onerror=i,document.head.appendChild(r)})}async function sa(){u(f,!0),u(l,""),x=[],I=[];try{let a=await fetch(s(E),{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);I=await a.json(),console.log(`Solicitando datos a: ${w}`);let i=await fetch(w,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`Error en la respuesta: ${i.status}`);let d=await i.json();if(d.length===0){if(console.warn("No hay datos. Cargando datos iniciales..."),!(await fetch(`${w}/loadInitialData`,{method:"GET"})).ok)throw new Error("No se pudo cargar datos iniciales");if(await new Promise(o=>setTimeout(o,1e3)),i=await fetch(w,{method:"GET",headers:{Accept:"application/json"}}),!i.ok)throw new Error("Error al obtener datos tras la carga inicial");d=await i.json()}x=d,console.log(`Datos recibidos: ${x.length} registros`),la()}catch(a){console.error(`ERROR G13: ${a}`),u(l,`Error al cargar datos G13: ${a.message}`)}finally{u(f,!1)}}async function na(){u(f,!0),u(l,"");try{console.log(`Solicitando datos a: ${D}`);const a=await fetch(D,{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Error en la respuesta: ${a.status}`);A=await a.json(),console.log(`Datos recibidos: ${A.length} registros`),ca()}catch(a){console.error(`ERROR al obtener datos: ${a}`),u(l,`Error al cargar datos: ${a.message}`)}finally{u(f,!1)}}function ca(){console.log("Estructura de los primeros datos:",JSON.stringify(A[0],null,2));const a={};A.forEach(d=>{const r=d.mun_name,o=d.amt_granted;a[r]||(a[r]=0),a[r]+=o}),console.log("Datos agrupados por municipio:",a);const t=Object.entries(a).map(([d,r])=>({name:d,y:r})).sort((d,r)=>r.y-d.y);if(console.log("Datos preparados para el gráfico:",t),t.length===0){u(l,"No se pudieron encontrar datos válidos de municipios y cantidades");return}let i=t.slice(0,10);if(t.length>10){const r=t.slice(10).reduce((o,h)=>o+h.y,0);i.push({name:"Otros municipios",y:r})}Highcharts.chart("container",{chart:{type:"pie",backgroundColor:"rgba(255, 255, 255, 0.8)"},title:{text:"Distribución de ayudas por municipios",align:"center",style:{fontWeight:"bold",fontSize:"18px"}},subtitle:{text:"Fuente: G18-dana-grants-subsidies-stats",align:"center"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f}%",style:{fontSize:"12px"}},showInLegend:!0}},tooltip:{pointFormat:"{series.name}: <b>{point.y:.0f}€</b> ({point.percentage:.1f}%)"},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle"},accessibility:{point:{valueSuffix:"€"}},series:[{name:"Importe total",colorByPoint:!0,data:i}],credits:{enabled:!0,text:"G18-dana-grants-subsidies-stats"}})}async function la(){await Pa();const a={};I.forEach(o=>{var h;if(((h=o.autonomous_community)==null?void 0:h.toLowerCase())==="andalucía"&&o.education_level==="TOTAL"){const y=o.year.toString();a[y]||(a[y]={activity_rate:null,project_count:null}),a[y].activity_rate=o.activity_rate}}),x.forEach(o=>{var h,y;if(((h=o.autonomous_community)==null?void 0:h.toLowerCase())==="andalucía"||((y=o.autonomous_community)==null?void 0:y.toLowerCase())==="andalucia"){const O=o.year.toString();a[O]||(a[O]={activity_rate:null,project_count:null}),a[O].project_count=o.project_count}});const t=Object.keys(a).sort(),i=t.map(o=>a[o].activity_rate),d=t.map(o=>a[o].project_count),r=document.getElementById("andaluciaChart");if(!r){console.error("No se encontró el canvas 'andaluciaChart'");return}new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"Tasa de Actividad (%)",data:i,backgroundColor:"rgba(255, 99, 132, 0.8)",borderColor:"rgb(255, 99, 132)",borderWidth:1},{label:"Número de Proyectos",data:d,backgroundColor:"rgba(54, 162, 235, 0.8)",borderColor:"rgb(54, 162, 235)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Datos de Andalucía por Año",font:{weight:"bold",size:18}},subtitle:{display:!0,text:"Fuente: API G13 y API Empleo"}},options:{scales:{y:{beginAtZero:!0}},ticks:{stepSize:10,font:{size:12}}}}})}Oa(async()=>{try{await _("https://code.highcharts.com/highcharts.js"),await _("https://code.highcharts.com/modules/heatmap.js"),await _("https://code.highcharts.com/modules/exporting.js"),await _("https://code.highcharts.com/modules/export-data.js"),await _("https://code.highcharts.com/modules/accessibility.js"),await _("https://cdn.jsdelivr.net/npm/chart.js"),await na(),await sa()}catch(a){u(l,`Error cargando scripts de Highcharts: ${a}`),console.error(a)}}),Ta();var j=qa();Aa(a=>{var t=Ra();ja.title="Integrations - Jaime Duffy Panés",Ga(2),p(a,t)});var N=n(j),G=e(n(N),4),P=n(G),z=e(n(P),4);g(z,"href",D);var L=e(z,2),M=e(n(L),2);{var da=a=>{var t=$a();p(a,t)};m(M,a=>{s(f)&&a(da)})}var pa=e(M,2);{var va=a=>{var t=Na(),i=n(t,!0);c(t),b(()=>C(i,s(l))),p(a,t)};m(pa,a=>{s(l)&&a(va)})}c(L),c(P);var k=e(P,2),F=e(n(k),4);g(F,"href",ia);var W=e(F,2),H=e(W,2),J=e(n(H),2);{var ua=a=>{var t=za();p(a,t)};m(J,a=>{s(f)&&a(ua)})}var ma=e(J,2);{var fa=a=>{var t=La(),i=n(t,!0);c(t),b(()=>C(i,s(l))),p(a,t)};m(ma,a=>{s(l)&&a(fa)})}c(H),c(k);var S=e(k,2),U=e(n(S),4);g(U,"href",$);var B=e(U,2),q=e(B,2),Y=e(n(q),2);{var ha=a=>{var t=Ma();p(a,t)};m(Y,a=>{s(f)&&a(ha)})}var ga=e(Y,2);{var _a=a=>{var t=Fa(),i=n(t,!0);c(t),b(()=>C(i,s(l))),p(a,t)};m(ga,a=>{s(l)&&a(_a)})}c(q),c(S);var T=e(S,2),Z=e(n(T),4);g(Z,"href",w);var K=e(Z,2),Q=e(K,2),ya=n(Q);{var ba=a=>{var t=Wa();p(a,t)},wa=(a,t)=>{{var i=r=>{var o=Ha(),h=n(o,!0);c(o),b(()=>C(h,s(l))),p(r,o)},d=r=>{var o=Ja();p(r,o)};m(a,r=>{s(l)?r(i):r(d,!1)},t)}};m(ya,a=>{s(f)?a(ba):a(wa,!1)})}c(Q),c(T);var V=e(T,2),X=e(n(V),4);g(X,"href",$);var aa=e(X,2),ta=e(aa,2),ea=e(n(ta),2);{var Ea=a=>{var t=Ua();p(a,t)};m(ea,a=>{s(f)&&a(Ea)})}var Ca=e(ea,2);{var xa=a=>{var t=Ba(),i=n(t,!0);c(t),b(()=>C(i,s(l))),p(a,t)};m(Ca,a=>{s(l)&&a(xa)})}c(ta),c(V),c(G),c(N),c(j),b(()=>{g(W,"href",s(E)),g(B,"href",s(E)),g(K,"href",s(E)),g(aa,"href",s(E))}),ka(3,G,()=>Sa,()=>({duration:400})),p(ra,j),Ia()}export{rt as component};
